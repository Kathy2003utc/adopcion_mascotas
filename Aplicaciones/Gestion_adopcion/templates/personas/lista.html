{% extends 'personas/plantilla.html' %}
{% load static %}

{% block contenido %}
<section class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-12">
      <h1 class="mb-4 text-center">Listado de Personas</h1>
      <div class="text-end mb-3">
        <a href="{% url 'crear_persona' %}" class="btn btn-success">
          <i class="bi bi-plus-circle"></i> Agregar Persona
        </a>
      </div>

      <!-- Tabla sin table-responsive -->
      <table id="tbl_personas" class="table table-bordered table-striped table-hover align-middle">
        <thead class="table-success text-center">
          <tr>
            <th>ID</th>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Cédula</th>
            <th>Teléfono</th>
            <th>Correo</th>
            <th>Dirección</th>
            <th>Fecha Registro</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for persona in Personas %}
            <tr>
              <td>{{ persona.id }}</td>
              <td>{{ persona.nombres }}</td>
              <td>{{ persona.apellidos }}</td>
              <td>{{ persona.cedula }}</td>
              <td>{{ persona.telefono|default:"-" }}</td>
              <td>{{ persona.correo }}</td>
              <td>{{ persona.direccion|default:"-" }}</td>
              <td>{{ persona.fecha_registro }}</td>

              <td class="text-center">
                <!-- Editar -->
                <a href="{% url 'editar_persona' persona.id %}" class="btn btn-outline-warning btn-sm" title="Editar">
                  <i class="bi bi-pencil"></i>
                </a>

                <!-- Eliminar -->
                <a href="#" class="btn btn-outline-danger btn-sm" title="Eliminar" onclick="confirmarEliminacion('{{ persona.id }}')">
                  <i class="bi bi-trash"></i>
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Confirmación de eliminación -->
<script>
function confirmarEliminacion(id) {
  Swal.fire({
    title: '¿Estás seguro?',
    text: '¡Esta acción no se puede deshacer!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = `{% url 'eliminar_persona' 0 %}`.replace('0', id);
    }
  });
}
</script>

<!-- DataTables -->
<script>
  $('#tbl_personas').DataTable({
      dom: 'Bfrtip',
      buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
      language: { url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' }
    });
  </script>

<!-- CSS para ajustar tabla al contenido -->
<style>
  table#tbl_personas {
    width: 100%;
    table-layout: auto;
  }
  table#tbl_personas th, table#tbl_personas td {
    white-space: nowrap;
    text-align: center;
  }
</style>

{% endblock %}
