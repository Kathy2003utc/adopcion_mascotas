{% extends 'personas/plantilla.html' %}
{% load static %}

{% block contenido %}
<section class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-12">
      <h1 class="mb-4 text-center">Listado de Adopciones</h1>
      <div class="text-end mb-3">
        <a href="{% url 'crear_adopcion' %}" class="btn btn-success">
          <i class="bi bi-plus-circle"></i> Nueva Adopción
        </a>
      </div>

      <table id="tbl_adopciones" class="table table-bordered table-striped table-hover align-middle">
        <thead class="table-success text-center">
          <tr>
            <th>ID</th>
            <th>Persona</th>
            <th>Mascota</th>
            <th>Fecha Adopción</th>
            <th>Observaciones</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for a in Adopciones %}
            <tr>
              <td>{{ a.id }}</td>
              <td>{{ a.persona.nombres }} {{ a.persona.apellidos }}</td>
              <td>{{ a.mascota.nombre }} ({{ a.mascota.especie }})</td>
              <td>{{ a.fecha_adopcion }}</td>
              <td>{{ a.observaciones|default:"-" }}</td>
              <td class="text-center">
                <a href="{% url 'editar_adopcion' a.id %}" class="btn btn-outline-warning btn-sm" title="Editar">
                  <i class="bi bi-pencil"></i>
                </a>
                <a href="#" class="btn btn-outline-danger btn-sm" title="Eliminar" onclick="confirmarEliminacion('{{ a.id }}')">
                  <i class="bi bi-trash"></i>
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<script>
function confirmarEliminacion(id) {
  Swal.fire({
    title: '¿Estás seguro?',
    text: '¡Esta acción no se puede deshacer!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = `{% url 'eliminar_adopcion' 0 %}`.replace('0', id);
    }
  });
}

$('#tbl_adopciones').DataTable({
  dom: 'Bfrtip',
  buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
  language: { url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' }
});
</script>
{% endblock %}
