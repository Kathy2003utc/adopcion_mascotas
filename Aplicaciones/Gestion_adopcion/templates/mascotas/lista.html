{% extends 'personas/plantilla.html' %}
{% load static %}

{% block contenido %}
<section class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-12">
      <h1 class="mb-4 text-center">Listado de Mascotas</h1>
      <div class="text-end mb-3">
        <a href="{% url 'crear_mascota' %}" class="btn btn-success">
          <i class="bi bi-plus-circle"></i> Agregar Mascota
        </a>
      </div>

      <table id="tbl_mascotas" class="table table-bordered table-striped table-hover align-middle">
        <thead class="table-success text-center">
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Especie</th>
            <th>Raza</th>
            <th>Edad</th>
            <th>Sexo</th>
            <th>Estado</th>
            <th>Fecha Ingreso</th>
            <th>Foto</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for mascota in Mascotas %}
          <tr>
            <td>{{ mascota.id }}</td>
            <td>{{ mascota.nombre }}</td>
            <td>{{ mascota.especie }}</td>
            <td>{{ mascota.raza|default:"-" }}</td>
            <td>{{ mascota.edad }}</td>
            <td>{{ mascota.sexo }}</td>
            <td>{{ mascota.estado }}</td>
            <td>{{ mascota.fecha_ingreso }}</td>
            <td>
              {% if mascota.foto %}
                <img src="{{ mascota.foto.url }}" alt="Foto" width="60">
              {% else %}
                -
              {% endif %}
            </td>
            <td class="text-center">
              <a href="{% url 'editar_mascota' mascota.id %}" class="btn btn-outline-warning btn-sm" title="Editar">
                <i class="bi bi-pencil"></i>
              </a>
              <a href="#" class="btn btn-outline-danger btn-sm" title="Eliminar" onclick="confirmarEliminacion('{{ mascota.id }}')">
                <i class="bi bi-trash"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<script>
function confirmarEliminacion(id) {
  Swal.fire({
    title: '¿Estás seguro?',
    text: '¡Esta acción no se puede deshacer!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Sí, eliminar',
    cancelButtonText: 'Cancelar'
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = `{% url 'eliminar_mascota' 0 %}`.replace('0', id);
    }
  });
}

$(document).ready(function () {
  $('#tbl_mascotas').DataTable({
    dom: 'Bfrtip',
    buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
    language: { url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json' },
    scrollX: false,
    autoWidth: false,
    columnDefs: [{ orderable: false, targets: -1 }]
  });
});
</script>

<style>
  table#tbl_mascotas { width: 100%; table-layout: auto; }
  table#tbl_mascotas th, table#tbl_mascotas td { white-space: nowrap; text-align: center; }
</style>
{% endblock %}
