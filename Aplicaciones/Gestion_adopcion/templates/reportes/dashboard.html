{% extends 'personas/plantilla.html' %}
{% block contenido %}
<h2 class="text-center">Dashboard de Adopciones</h2>

<!-- Grafica 1: Adopciones por Persona -->
<div style="width: 80%; margin: auto; margin-top: 30px;">
    <canvas id="adopcionesPersona"></canvas>
</div>

<!-- Grafica 2: Mascotas por Estado -->
<div style="width: 80%; margin: auto; margin-top: 50px;">
    <canvas id="mascotasEstado"></canvas>
</div>

<!-- Grafica 3: Mascotas por Especie -->
<div style="width: 80%; margin: auto; margin-top: 50px;">
    <canvas id="mascotasEspecie"></canvas>
</div>

<!-- Grafica 4: Adopciones por Especie -->
<div style="width: 80%; margin: auto; margin-top: 50px; margin-bottom: 50px;">
    <canvas id="adopcionesEspecie"></canvas>
</div>

<!-- Convertir listas Django a JSON seguro -->
{{ personas|json_script:"personas_data" }}
{{ total_adopciones|json_script:"adopciones_data" }}
{{ estados|json_script:"estados_data" }}
{{ total_mascotas_estado|json_script:"mascotas_estado_data" }}
{{ especies|json_script:"especies_data" }}
{{ total_mascotas_especie|json_script:"mascotas_especie_data" }}
{{ especies_adoptadas|json_script:"especies_adoptadas_data" }}
{{ total_adopciones_especie|json_script:"adopciones_especie_data" }}

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Leer datos desde json_script
    const personas = JSON.parse(document.getElementById('personas_data').textContent);
    const total_adopciones = JSON.parse(document.getElementById('adopciones_data').textContent);
    const estados = JSON.parse(document.getElementById('estados_data').textContent);
    const total_mascotas_estado = JSON.parse(document.getElementById('mascotas_estado_data').textContent);
    const especies = JSON.parse(document.getElementById('especies_data').textContent);
    const total_mascotas_especie = JSON.parse(document.getElementById('mascotas_especie_data').textContent);
    const especies_adoptadas = JSON.parse(document.getElementById('especies_adoptadas_data').textContent);
    const total_adopciones_especie = JSON.parse(document.getElementById('adopciones_especie_data').textContent);

    // Grafica 1: Adopciones por Persona
    new Chart(document.getElementById('adopcionesPersona'), {
        type: 'bar',
        data: {
            labels: personas,
            datasets: [{
                label: 'Número de Adopciones',
                data: total_adopciones,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Adopciones por Persona' }
            },
            scales: { y: { beginAtZero: true } }
        }
    });

    // Grafica 2: Mascotas por Estado
    new Chart(document.getElementById('mascotasEstado'), {
        type: 'bar',
        data: {
            labels: estados,
            datasets: [{
                label: 'Número de Mascotas',
                data: total_mascotas_estado,
                backgroundColor: ['rgba(75, 192, 192, 0.6)','rgba(255, 99, 132, 0.6)'],
                borderColor: ['rgba(75, 192, 192, 1)','rgba(255, 99, 132, 1)'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Mascotas por Estado' }
            },
            scales: { y: { beginAtZero: true } }
        }
    });

    // Grafica 3: Mascotas por Especie
    new Chart(document.getElementById('mascotasEspecie'), {
        type: 'bar',
        data: {
            labels: especies,
            datasets: [{
                label: 'Número de Mascotas',
                data: total_mascotas_especie,
                backgroundColor: 'rgba(255, 206, 86, 0.6)',
                borderColor: 'rgba(255, 206, 86, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Mascotas por Especie' }
            },
            scales: { y: { beginAtZero: true } }
        }
    });

    // Grafica 4: Adopciones por Especie
    new Chart(document.getElementById('adopcionesEspecie'), {
        type: 'bar',
        data: {
            labels: especies_adoptadas,
            datasets: [{
                label: 'Número de Adopciones',
                data: total_adopciones_especie,
                backgroundColor: 'rgba(153, 102, 255, 0.6)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Adopciones por Especie' }
            },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>
{% endblock %}
